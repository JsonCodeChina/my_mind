# Claude Code 最佳实践详解

## 📖 文章信息

- **标题**：Claude Code Best Practices
- **来源**：cc.deeptoai.com 社区文档
- **原文链接**：https://cc.deeptoai.com/docs/zh/best-practices/claude-code-best-practices
- **适合人群**：所有 Claude Code 用户

## 🎯 核心内容

### 1. 自定义设置

#### 创建 CLAUDE.md 文件

**什么是 CLAUDE.md？**
- 这是一个特殊文件，会自动引入到对话上下文中
- Claude 会读取这个文件来了解你的项目

**CLAUDE.md 应该包含什么？**

```markdown
# 项目说明

## 常用 Bash 命令
npm run dev          # 启动开发服务器
npm run build        # 构建生产版本
npm test             # 运行测试

## 核心文件说明
- src/index.ts       # 应用入口
- src/utils/         # 工具函数库
- tests/             # 测试文件

## 代码风格指南
- 使用 TypeScript
- 缩进：2 个空格
- 引号：单引号
- 末尾分号：必须

## 测试说明
- 所有新功能必须有单元测试
- 测试覆盖率 >80%
- 使用 Jest 框架

## 存储库礼仪
- 提交信息格式：type(scope): message
- 遵循 Conventional Commits 规范

## 开发环境设置
Node.js >= 18
npm >= 9

## 项目特定警告
⚠️ 不要修改 /legacy 目录下的文件
⚠️ API 密钥存储在环境变量中，不要硬编码
```

**CLAUDE.md 文件位置建议**

1. **项目根目录**
   ```
   my-project/
   ├── CLAUDE.md        ← 这里
   ├── src/
   └── package.json
   ```

2. **运行 claude 的父/子目录**
   ```
   workspace/
   ├── CLAUDE.md        ← 这里也可以
   └── project1/
   └── project2/
   ```

3. **主文件夹（全局配置）**
   ```
   ~/.claude/CLAUDE.md  ← 适用于所有项目的通用设置
   ```

**优先级**：项目根目录 > 当前目录 > 主文件夹

---

### 2. 为 Claude 提供更多工具

#### a) 与 Bash 工具集成

Claude Code 可以直接执行 bash 命令，你可以：

```bash
# 安装项目依赖
npm install lodash

# 运行脚本
./scripts/deploy.sh

# 查看日志
tail -f logs/app.log

# Git 操作
git status
git log --oneline
```

**技巧**：将常用命令写入 CLAUDE.md，Claude 会知道如何使用它们。

#### b) 使用 MCP (Model Context Protocol) 服务器

MCP 允许 Claude 访问外部工具和服务：

- **数据库查询**：直接查询数据库
- **API 调用**：访问外部 API
- **文件系统**：扩展文件操作能力
- **自定义工具**：集成你的专用工具

**示例配置**：
```json
{
  "mcpServers": {
    "database": {
      "command": "mcp-server-postgres",
      "args": ["postgresql://localhost/mydb"]
    }
  }
}
```

#### c) 自定义斜杠命令

创建常用任务的快捷方式：

**示例**：创建 `.claude/commands/review.md`
```markdown
---
description: 代码审查
---

审查以下内容：
1. 代码质量和可读性
2. 潜在的 bug
3. 性能问题
4. 安全隐患
5. 最佳实践遵循情况

生成详细的审查报告，包括改进建议。
```

使用方式：输入 `/review`

---

### 3. 常见工作流程

#### a) 探索 → 计划 → 编码 → 提交

**第一步：探索**
```
"帮我了解 src/auth 模块的结构"
"这个项目使用什么认证方案？"
```

**第二步：计划**
```
"我需要添加 OAuth 登录功能，请制定实施计划"
```

**第三步：编码**
```
"按照计划实施 OAuth 登录功能"
```

**第四步：提交**
```
"创建一个 git commit，包含刚才的更改"
```

#### b) 测试驱动开发 (TDD)

**标准 TDD 流程**：

1. **编写测试**
   ```
   "为用户注册功能编写单元测试"
   ```

2. **确认测试失败**
   ```
   "运行测试，确认它们失败"
   ```

3. **编写代码**
   ```
   "实现用户注册功能，使测试通过"
   ```

4. **验证测试通过**
   ```
   "运行测试，确认全部通过"
   ```

5. **重构**
   ```
   "重构代码，提高可读性，保持测试通过"
   ```

**TDD 的优势**：
- 确保代码可测试
- 明确需求和边界
- 减少 bug
- 便于重构

#### c) 代码截图和可视化迭代

**使用场景**：UI 开发、样式调整

**流程**：
1. 实现初版 UI
2. 截图查看效果
3. 描述需要的改进
4. Claude 调整代码
5. 重复 2-4 直到满意

**示例对话**：
```
你："这是当前的页面截图，按钮太小了，颜色也不够突出"
Claude："我会增大按钮，使用更鲜艳的蓝色"
```

#### d) 安全的 "YOLO" 模式

**什么是 YOLO 模式？**
- 绕过某些权限检查
- 让 Claude 直接执行操作
- 适用于简单、低风险任务

**使用场景**：
- 快速原型开发
- 简单的脚本任务
- 个人项目

**注意**：生产环境请谨慎使用！

---

### 4. 有效提示技巧

#### 包含所有相关信息

**❌ 不好的提示**：
```
"修复这个 bug"
```

**✅ 好的提示**：
```
"修复 src/utils/date.ts 文件中的 bug。
问题：formatDate 函数在处理闰年 2 月 29 日时返回错误。
期望：正确处理所有日期，包括闰年。
错误信息：Invalid Date
测试用例：formatDate(new Date('2024-02-29'))
```

#### 使用图片

**场景**：
- UI/UX 问题
- 错误截图
- 设计稿

**示例**：
```
"根据这个设计稿实现登录页面"
[附上设计稿图片]
```

#### 提及特定文件

**有文件上下文更好**：
```
"在 src/api/user.ts 中添加一个新的端点 getUserProfile"
```

Claude 会自动读取该文件，了解现有代码结构。

#### 提供 URL

**直接引用在线资源**：
```
"参考这个 API 文档实现：https://api.example.com/docs
需要实现用户认证和数据获取功能"
```

#### 及时纠正

**如果 Claude 理解有误，立即纠正**：

```
你："添加一个搜索功能"
Claude："[开始实现数据库全文搜索]"
你："等等，我只需要简单的字符串匹配，不需要全文搜索"
Claude："好的，我改用简单的字符串匹配方案"
```

**不要等到最后才说**，这样可以节省时间。

---

## 💡 进阶技巧

### 1. 利用上下文记忆

Claude 会记住对话中的信息，充分利用这一点：

```
对话开始：
"我们使用 React + TypeScript + Tailwind CSS"

后续对话中，Claude 会自动：
- 使用 TypeScript 语法
- 使用 Tailwind 类名
- 遵循 React 最佳实践
```

### 2. 分阶段处理复杂任务

**大任务拆分**：
```
阶段1："设计数据库模型"
阶段2："实现 API 端点"
阶段3："创建前端组件"
阶段4："添加测试"
阶段5："文档更新"
```

### 3. 使用检查点

**定期确认进度**：
```
"现在暂停，总结一下我们完成了什么，还需要做什么"
```

### 4. 明确你的风格偏好

**在 CLAUDE.md 中声明**：
```markdown
## 代码风格偏好
- 优先使用函数式编程
- 避免过度抽象
- 注释要说明"为什么"而非"是什么"
- 变量名要有业务语义
```

---

## 🚀 实战案例

### 案例1：快速原型开发

```
第1轮："创建一个待办事项应用的基础结构"
第2轮："添加增删改查功能"
第3轮："添加本地存储"
第4轮："美化 UI"
第5轮："添加过滤和排序"
```

### 案例2：Bug 修复

```
第1轮："分析 logs/error.log，找出导致崩溃的原因"
第2轮："修复 src/parser.ts 中的空指针异常"
第3轮："添加防御性代码，避免类似问题"
第4轮："为这个修复编写测试用例"
```

### 案例3：代码重构

```
第1轮："审查 src/legacy/processor.js，识别代码异味"
第2轮："将其重构为 TypeScript，使用现代语法"
第3轮："拆分成多个小模块"
第4轮："添加类型注解和文档"
第5轮："确保所有测试仍然通过"
```

---

## 📊 效果评估

采用这些最佳实践后：

- **开发速度**：提升 3-5 倍
- **代码质量**：更一致，更规范
- **Bug 率**：显著降低
- **学习曲线**：新手更快上手
- **团队协作**：标准化流程

---

## 🔗 相关资源

- [官方文档](https://docs.claude.com/en/docs/claude-code/overview)
- [社区技巧集锦](../tips/community-tips.md)
- [工具推荐](../tools/recommended-tools.md)

---

**推荐指数**：⭐⭐⭐⭐⭐
**难度等级**：入门到中级
**建议**：逐条实践，找到适合自己的工作流
